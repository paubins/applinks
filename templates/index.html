<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

   <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.3/dist/jquery.validate.min.js"></script>
	<script src="https://www.google.com/recaptcha/api.js"></script>
	 <script>
	   function onSubmit(token) {
	     document.getElementById("main-form").submit();
	   }
	 </script>
	<script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
  crossorigin="anonymous"></script>
    <meta charset="utf-8">
    <title>Create AASA file</title>
    <style>
    #overlay {
  background: #ffffff;
  color: #666666;
  position: fixed;
  height: 100%;
  width: 100%;
  z-index: 5000;
  top: 0;
  left: 0;
  float: left;
  text-align: center;
  padding-top: 25%;
  opacity: .80;
}
.spinner {
    margin: 0 auto;
    height: 64px;
    width: 64px;
    animation: rotate 0.8s infinite linear;
    border: 5px solid firebrick;
    border-right-color: transparent;
    border-radius: 50%;
}
@keyframes rotate {
    0% {
        transform: rotate(0deg);
    }
    100% {
        transform: rotate(360deg);
    }
}
</style>

    <title>Universal Link - {{ domain }}</title>
  </head>
  <body>
    <div class="container" style="margin-top: 30px">
    {% if created %}
    <div class="alert alert-success" role="alert">
        Universal link created! Add "applinks:{{ domain }}" to your associated domains within your entitlement.
    </div>
    {% endif %}
    <h4>Generate a random subdomain with an attached apple-app-site-association file to use in your app:</h4>
<form id="main-form" role="form" action="/" method="POST">
    {% for detail in applinks.details %}
    <label>App IDs (&lt;Application Identifier Prefix&gt;.&lt;Bundle Identifier&gt;) </label><br/><br/>
    <div class="multi-field-wrapper">
      <div class="multi-fields">
        {% for appID in detail.appIDs %}
        <div class="multi-field">
            <div class="row">
                <div class="col">
                    <input type="text" placeholder="App ID(aka Team ID)" value="{{ appID|getappid }}" required name="appIDs[]">
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <input type="text" placeholder="Bundle Identifier" value="{{ appID|getbundleid }}" required name="bundleIDs[]">
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <button type="button" class="remove-field btn btn-primary btn-sm">Remove</button>
                </div>
            </div>
        </div>
        {% else %}
        <div class="multi-field row">
            <div class="col">
                <input type="text" placeholder="App ID(aka Team ID)" required name="appIDs[]">
            </div>
            <div class="col">
                <input type="text" placeholder="Bundle Identifier" required name="bundleIDs[]">
            </div>
            <div class="col">
                <button type="button" class="remove-field btn btn-primary btn-sm">Remove</button>
            </div>
        </div>
        {% endfor %}
      </div>
     <br/>
    <button type="button" class="add-field btn btn-primary">Add App ID</button>
  </div>
    
  <br/><br/>
        <div class="multi-field-wrapper">
          <div class="multi-fields">
            {% for component in detail.components %}
            <div class="multi-field row">
            {% for key, value in component.items() %}
              {% if key != "comment" and key != "exclude" %}
             <div class="col"><input type="text" required placeholder="path(for example: '/')" value="{{ key }}" name="paths[]"></div>
             <div class="col"><input type="text" required placeholder="path(for example: '/buy/*')" value="{{ value }}" name="patterns[]"></div>
             {% elif key == "comment" %}
             <div class="col"><input type="text" placeholder="comment" value="{{ component.comment }}" name="comments[]"></div>
             {% elif key == "exclude" %}
             <div class="col"><input type="checkbox" id="exclude" rel="exclude[]" {% if component.exclude %}checked{% else %}unchecked{% endif %}/> Exclude&#9;</div>
             <div class="col"><button type="button" class="remove-field btn btn-primary btn-sm">Remove</button></div>
            {% endif %}
            {% endfor %}
            </div>
            {% else %}
            <div class="multi-field row">
             <div class="col"><input type="text" required placeholder="path(for example: '/')" name="paths[]"></div>
             <div class="col"><input type="text" required placeholder="path(for example: '/buy/*')" name="patterns[]"></div>
             <div class="col"><input type="text" placeholder="comment" name="comments[]"></div>
             <div class="col"><input type="checkbox" id="exclude" rel="exclude[]"/> Exclude&#9;</div>
           
              <div class="col"><button type="button" class="remove-field btn btn-primary btn-sm">Remove</button></div>
            </div>
            {% endfor %}
          </div>
          <br/>
        <button type="button" class="add-field btn btn-primary">Add path</button>
      </div>
  {% endfor %}
  <br/><br/>
  <span>
<p>Note: Univeral links only work if clicked on from a link sent with in most of the popular messaging apps.
They will not work if you put the URL directly in the address bar.</p><br/>
</span>
<label for="phone">Send link to phone number(US-based only for now):</label>&nbsp;<input id="phone" type="phone" name="phone" placeholder="phone number" />
<br/>Note: We do not store phone numbers<br/><br/>
	
  <!-- <input type="submit" id="submitButton" value="Create AASA"/> -->
  {% if applinks %}
  <button class="btn btn-primary g-recaptcha" 
        data-sitekey="6LeXSbobAAAAAEDy7tOiAG7OiTGJLGZaHHPul19Q" 
        data-callback='onSubmit' 
        data-action='submit'>Update</button>
  {% else %}
    <button class="btn btn-primary g-recaptcha" 
        data-sitekey="6LeXSbobAAAAAEDy7tOiAG7OiTGJLGZaHHPul19Q" 
        data-callback='onSubmit' 
        data-action='submit'>Submit</button>
  {% endif %}
</form>

</div>
<div id="result"></div>
<div id="result1"></div>
<div id="overlay" style="display:none;">
    <div class="spinner"></div>
    <br/>
    Loading...
</div>
    <script>
 var chk = $('input[type="checkbox"]');
    chk.each(function(){
        var v = $(this).attr('checked') == 'checked'?1:0;
        $(this).after('<input type="hidden" name="'+$(this).attr('rel')+'" value="'+v+'" />');
    });

chk.change(function(){ 
        var v = $(this).is(':checked')?1:0;
        $(this).next('input[type="hidden"]').val(v);
    });

 $("#submitButton").click(function(data) {
 	$('#result').html("<pre>" + JSON.stringify($("form").serializeArray(), null, 2) + "</pre>");
 	$('#result1').html("<pre>" + $("form").serialize() + "</pre>");
 	// return false;
 	$('#overlay').fadeIn().delay(500).fadeOut();

 });

$('.multi-field-wrapper').each(function() {
    var $wrapper = $('.multi-fields', this);
    $(".add-field", $(this)).click(function(e) {
        $('.multi-field:first-child', $wrapper).clone(true).appendTo($wrapper).find('input').val('').focus();
    });
    $('.multi-field .remove-field', $wrapper).click(function() {
        if ($('.multi-field', $wrapper).length > 1)
            $(this).parent().parent('.multi-field').remove();
    });
});

$('.multi-field-wrapper2').each(function() {
    var $wrapper = $('.multi-fields', this);
    $(".add-field", $(this)).click(function(e) {
        $('.multi-field:first-child', $wrapper).clone(true).appendTo($wrapper).find('input').val('').focus();
    });
    $('.multi-field .remove-field', $wrapper).click(function() {
        if ($('.multi-field', $wrapper).length > 1)
            $(this).parent().parent('.multi-field').remove();
    });
});
    </script>

    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

    <!-- Option 2: Separate Popper and Bootstrap JS -->
    <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
    -->
  </body>
</html>